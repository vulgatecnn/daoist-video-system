# Alertmanager é…ç½®æ–‡ä»¶

global:
  # SMTP é…ç½®
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'alerts@your-domain.com'
  smtp_auth_username: 'alerts@your-domain.com'
  smtp_auth_password: 'your-email-password'
  smtp_require_tls: true

# å‘Šè­¦è·¯ç”±é…ç½®
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  receiver: 'default-receiver'
  
  routes:
    # ä¸¥é‡å‘Šè­¦ - ç«‹å³é€šçŸ¥
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 0s
      repeat_interval: 5m
    
    # è­¦å‘Šçº§åˆ«å‘Šè­¦
    - match:
        severity: warning
      receiver: 'warning-alerts'
      group_wait: 30s
      repeat_interval: 30m
    
    # æ•°æ®åº“ç›¸å…³å‘Šè­¦
    - match:
        service: database
      receiver: 'database-alerts'
      group_wait: 15s
      repeat_interval: 15m
    
    # åº”ç”¨æœåŠ¡å‘Šè­¦
    - match:
        service: application
      receiver: 'application-alerts'
      group_wait: 20s
      repeat_interval: 20m

# å‘Šè­¦æ¥æ”¶å™¨é…ç½®
receivers:
  # é»˜è®¤æ¥æ”¶å™¨
  - name: 'default-receiver'
    email_configs:
      - to: 'admin@your-domain.com'
        subject: '[é“æ•™è§†é¢‘ç³»ç»Ÿ] å‘Šè­¦é€šçŸ¥'
        body: |
          å‘Šè­¦è¯¦æƒ…:
          
          å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
          ä¸¥é‡ç¨‹åº¦: {{ .GroupLabels.severity }}
          æœåŠ¡: {{ .GroupLabels.service }}
          å®ä¾‹: {{ .GroupLabels.instance }}
          
          å‘Šè­¦æè¿°:
          {{ range .Alerts }}
          - {{ .Annotations.summary }}
            è¯¦æƒ…: {{ .Annotations.description }}
            æ—¶é—´: {{ .StartsAt }}
          {{ end }}
          
          æŸ¥çœ‹è¯¦æƒ…: http://your-domain.com:9090
    
    slack_configs:
      - api_url: 'YOUR_SLACK_WEBHOOK_URL'
        channel: '#alerts'
        title: 'é“æ•™è§†é¢‘ç³»ç»Ÿå‘Šè­¦'
        text: |
          *å‘Šè­¦åç§°:* {{ .GroupLabels.alertname }}
          *ä¸¥é‡ç¨‹åº¦:* {{ .GroupLabels.severity }}
          *æœåŠ¡:* {{ .GroupLabels.service }}
          
          {{ range .Alerts }}
          *æ‘˜è¦:* {{ .Annotations.summary }}
          *æè¿°:* {{ .Annotations.description }}
          *æ—¶é—´:* {{ .StartsAt }}
          {{ end }}

  # ä¸¥é‡å‘Šè­¦æ¥æ”¶å™¨
  - name: 'critical-alerts'
    email_configs:
      - to: 'admin@your-domain.com,ops@your-domain.com'
        subject: '[ç´§æ€¥] é“æ•™è§†é¢‘ç³»ç»Ÿä¸¥é‡å‘Šè­¦'
        body: |
          ğŸš¨ ä¸¥é‡å‘Šè­¦ ğŸš¨
          
          å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
          æœåŠ¡: {{ .GroupLabels.service }}
          å®ä¾‹: {{ .GroupLabels.instance }}
          
          {{ range .Alerts }}
          æ‘˜è¦: {{ .Annotations.summary }}
          æè¿°: {{ .Annotations.description }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          {{ end }}
          
          è¯·ç«‹å³æ£€æŸ¥ç³»ç»ŸçŠ¶æ€ï¼
          ç›‘æ§é¢æ¿: http://your-domain.com:3000
          Prometheus: http://your-domain.com:9090
    
    slack_configs:
      - api_url: 'YOUR_SLACK_WEBHOOK_URL'
        channel: '#critical-alerts'
        title: 'ğŸš¨ ä¸¥é‡å‘Šè­¦'
        color: 'danger'
        text: |
          *å‘Šè­¦:* {{ .GroupLabels.alertname }}
          *æœåŠ¡:* {{ .GroupLabels.service }}
          *å®ä¾‹:* {{ .GroupLabels.instance }}
          
          {{ range .Alerts }}
          *æ‘˜è¦:* {{ .Annotations.summary }}
          *æè¿°:* {{ .Annotations.description }}
          {{ end }}
        
        actions:
          - type: button
            text: 'æŸ¥çœ‹ç›‘æ§'
            url: 'http://your-domain.com:3000'
          - type: button
            text: 'æŸ¥çœ‹æ—¥å¿—'
            url: 'http://your-domain.com:9090'
    
    # ä¼ä¸šå¾®ä¿¡é€šçŸ¥ (å¯é€‰)
    wechat_configs:
      - corp_id: 'YOUR_CORP_ID'
        api_secret: 'YOUR_API_SECRET'
        to_user: '@all'
        agent_id: 'YOUR_AGENT_ID'
        message: |
          ä¸¥é‡å‘Šè­¦é€šçŸ¥
          
          å‘Šè­¦: {{ .GroupLabels.alertname }}
          æœåŠ¡: {{ .GroupLabels.service }}
          
          {{ range .Alerts }}
          {{ .Annotations.summary }}
          {{ end }}

  # è­¦å‘Šçº§åˆ«å‘Šè­¦æ¥æ”¶å™¨
  - name: 'warning-alerts'
    email_configs:
      - to: 'ops@your-domain.com'
        subject: '[è­¦å‘Š] é“æ•™è§†é¢‘ç³»ç»Ÿå‘Šè­¦'
        body: |
          âš ï¸ è­¦å‘Šå‘Šè­¦ âš ï¸
          
          å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
          æœåŠ¡: {{ .GroupLabels.service }}
          å®ä¾‹: {{ .GroupLabels.instance }}
          
          {{ range .Alerts }}
          æ‘˜è¦: {{ .Annotations.summary }}
          æè¿°: {{ .Annotations.description }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          {{ end }}
    
    slack_configs:
      - api_url: 'YOUR_SLACK_WEBHOOK_URL'
        channel: '#warnings'
        title: 'âš ï¸ è­¦å‘Šå‘Šè­¦'
        color: 'warning'
        text: |
          *å‘Šè­¦:* {{ .GroupLabels.alertname }}
          *æœåŠ¡:* {{ .GroupLabels.service }}
          
          {{ range .Alerts }}
          {{ .Annotations.summary }}
          {{ end }}

  # æ•°æ®åº“å‘Šè­¦æ¥æ”¶å™¨
  - name: 'database-alerts'
    email_configs:
      - to: 'dba@your-domain.com,ops@your-domain.com'
        subject: '[æ•°æ®åº“] é“æ•™è§†é¢‘ç³»ç»Ÿæ•°æ®åº“å‘Šè­¦'
        body: |
          ğŸ—„ï¸ æ•°æ®åº“å‘Šè­¦ ğŸ—„ï¸
          
          å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
          æ•°æ®åº“å®ä¾‹: {{ .GroupLabels.instance }}
          
          {{ range .Alerts }}
          æ‘˜è¦: {{ .Annotations.summary }}
          æè¿°: {{ .Annotations.description }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          {{ end }}
          
          å»ºè®®ç«‹å³æ£€æŸ¥æ•°æ®åº“çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡ã€‚
    
    slack_configs:
      - api_url: 'YOUR_SLACK_WEBHOOK_URL'
        channel: '#database-alerts'
        title: 'ğŸ—„ï¸ æ•°æ®åº“å‘Šè­¦'
        color: '#FF9900'
        text: |
          *æ•°æ®åº“å‘Šè­¦:* {{ .GroupLabels.alertname }}
          *å®ä¾‹:* {{ .GroupLabels.instance }}
          
          {{ range .Alerts }}
          {{ .Annotations.summary }}
          {{ end }}

  # åº”ç”¨æœåŠ¡å‘Šè­¦æ¥æ”¶å™¨
  - name: 'application-alerts'
    email_configs:
      - to: 'dev@your-domain.com,ops@your-domain.com'
        subject: '[åº”ç”¨] é“æ•™è§†é¢‘ç³»ç»Ÿåº”ç”¨å‘Šè­¦'
        body: |
          ğŸš€ åº”ç”¨å‘Šè­¦ ğŸš€
          
          å‘Šè­¦åç§°: {{ .GroupLabels.alertname }}
          åº”ç”¨å®ä¾‹: {{ .GroupLabels.instance }}
          
          {{ range .Alerts }}
          æ‘˜è¦: {{ .Annotations.summary }}
          æè¿°: {{ .Annotations.description }}
          å¼€å§‹æ—¶é—´: {{ .StartsAt }}
          {{ end }}
    
    slack_configs:
      - api_url: 'YOUR_SLACK_WEBHOOK_URL'
        channel: '#app-alerts'
        title: 'ğŸš€ åº”ç”¨å‘Šè­¦'
        color: '#0099CC'
        text: |
          *åº”ç”¨å‘Šè­¦:* {{ .GroupLabels.alertname }}
          *å®ä¾‹:* {{ .GroupLabels.instance }}
          
          {{ range .Alerts }}
          {{ .Annotations.summary }}
          {{ end }}

# å‘Šè­¦æŠ‘åˆ¶è§„åˆ™
inhibit_rules:
  # å¦‚æœæœåŠ¡å®Œå…¨ä¸å¯ç”¨ï¼ŒæŠ‘åˆ¶å…¶ä»–ç›¸å…³å‘Šè­¦
  - source_match:
      alertname: 'ServiceDown'
    target_match:
      service: '{{ .source.service }}'
    equal: ['service', 'instance']
  
  # å¦‚æœæ•°æ®åº“ä¸å¯ç”¨ï¼ŒæŠ‘åˆ¶åº”ç”¨ç›¸å…³å‘Šè­¦
  - source_match:
      alertname: 'DatabaseDown'
    target_match:
      alertname: 'HighErrorRate'
    equal: ['instance']
  
  # å¦‚æœç£ç›˜ç©ºé—´ä¸¥é‡ä¸è¶³ï¼ŒæŠ‘åˆ¶å…¶ä»–ç£ç›˜ç›¸å…³å‘Šè­¦
  - source_match:
      alertname: 'DiskSpaceCritical'
    target_match:
      alertname: 'DiskSpaceLow'
    equal: ['instance']

# é™é»˜è§„åˆ™æ¨¡æ¿
templates:
  - '/etc/alertmanager/templates/*.tmpl'