# 道教经文视频系统 - 服务启动说明

## 快速启动

### 方法一：使用批处理文件（推荐 Windows 用户）

1. **启动服务**
   - 双击 `启动服务.bat` 文件
   - 会自动打开两个命令行窗口，分别运行前后端服务

2. **停止服务**
   - 双击 `停止服务.bat` 文件
   - 或者直接关闭前后端的命令行窗口

### 方法二：使用 PowerShell 脚本（功能更强大）

1. **启动服务**
   - 右键点击 `启动服务.ps1`
   - 选择"使用 PowerShell 运行"
   - 或在 PowerShell 中执行：`.\启动服务.ps1`

2. **停止服务**
   - 右键点击 `停止服务.ps1`
   - 选择"使用 PowerShell 运行"
   - 或在 PowerShell 中执行：`.\停止服务.ps1`

### 方法三：手动启动（适合开发调试）

#### 启动后端
```bash
cd backend
python manage.py runserver
```

#### 启动前端
```bash
cd frontend
npm start
```

## 服务地址

启动成功后，可以访问以下地址：

- **前端应用**: http://localhost:5500/
- **后端 API**: http://localhost:6000/api/
- **管理后台**: http://localhost:6000/admin/
- **API 文档**: http://localhost:6000/api/docs/

## 默认账号

### 管理员账号
- 用户名: `admin`
- 密码: `admin123`
- 角色: 管理员
- 权限: 完整的系统管理权限

### 测试用户
- 用户名: `testuser`
- 密码: `test123`
- 角色: 普通用户
- 权限: 基本的视频上传和管理功能

## 常见问题

### 1. 端口被占用

如果提示端口被占用，可以：

**方法 A：停止占用端口的进程**
```powershell
# 查看端口占用
netstat -ano | findstr :6000
netstat -ano | findstr :5500

# 停止进程（替换 PID 为实际进程号）
taskkill /F /PID <进程号>
```

**方法 B：修改端口配置**

后端端口（在 backend 目录）：
```bash
python manage.py runserver 6001
```

前端端口（修改 `frontend/.env` 文件）：
```
PORT=5501
```

### 2. Python 或 Node.js 未找到

确保已安装并添加到系统 PATH：
- Python 3.8+
- Node.js 16+

### 3. 依赖未安装

**后端依赖**
```bash
cd backend
pip install -r requirements.txt
```

**前端依赖**
```bash
cd frontend
npm install
```

### 4. 数据库未初始化

```bash
cd backend
python manage.py migrate
python manage.py createsuperuser
```

### 5. 前端编译错误

清除缓存并重新安装：
```bash
cd frontend
rm -rf node_modules package-lock.json
npm install
```

### 6. CORS 跨域错误

检查后端 `settings.py` 中的 CORS 配置：
```python
CORS_ALLOWED_ORIGINS = [
    "http://localhost:5500",
    "http://localhost:5501",
]
```

## 开发提示

### 热重载
- 后端：Django 自动检测文件变化并重载
- 前端：React 自动检测文件变化并热更新

### 日志查看
- 后端日志：在后端命令行窗口查看
- 前端日志：在浏览器开发者工具的 Console 查看

### 调试模式
- 后端：已启用 Django DEBUG 模式
- 前端：使用 React 开发模式，包含详细错误信息

## 生产环境部署

生产环境请使用以下方式：

### 后端
```bash
# 使用 gunicorn 或 uwsgi
gunicorn daoist_video_system.wsgi:application --bind 0.0.0.0:6000
```

### 前端
```bash
# 构建生产版本
npm run build

# 使用 nginx 或其他 Web 服务器托管 build 目录
```

## 技术支持

如遇到问题，请检查：
1. 后端命令行窗口的错误信息
2. 前端浏览器控制台的错误信息
3. 后端日志文件：`backend/logs/`

## 更新日志

- 2024-12-20: 创建启动脚本和说明文档
- 支持批处理和 PowerShell 两种启动方式
- 添加自动环境检查和端口清理功能
